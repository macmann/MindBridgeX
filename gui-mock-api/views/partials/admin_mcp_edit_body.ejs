<section class="page-hero">
  <div class="page-hero__content">
    <h2><%= s.id ? 'Edit MCP Server' : 'New MCP Server' %></h2>
    <p>Base URL should point to your mock API runtime (e.g. http://localhost:3000 or your Render URL).</p>
  </div>
  <div class="page-hero__actions">
    <a class="secondary" href="/admin/mcp?key=<%= encodeURIComponent(query?.key || '') %>">Back to servers</a>
  </div>
</section>

<% const enableToggleId = `mcp-enabled-${s.id || 'new'}`; %>

<section class="surface-card surface-card--stacked">
  <form method="post" action="/admin/mcp/save?key=<%= encodeURIComponent(query?.key || '') %>" class="form-stack">
    <input type="hidden" name="id" value="<%= s.id || '' %>"/>

    <% if (errorMessage) { %>
      <div class="flash flash-error"><%= errorMessage %></div>
    <% } %>

    <% if (query?.saved === 'auth') { %>
      <div class="flash flash-success">Authentication settings updated.</div>
    <% } %>

    <div class="form-grid form-grid--two">
      <label class="stack">
        <span>Name</span>
        <input name="name" required value="<%= s.name || '' %>"/>
      </label>

      <label class="stack">
        <span>Slug (URL path)</span>
        <input
          name="slug"
          value="<%= s.slug || '' %>"
          placeholder="mcp-company-a"
          pattern="[a-z0-9-]*"
        />
        <small class="muted">Used in the MCP URL, e.g. <code>/mcp/&lt;slug&gt;</code> (lowercase letters, digits, hyphens). Leave blank to generate automatically.</small>
      </label>
    </div>

    <label class="stack">
      <span>Description</span>
      <input name="description" value="<%= s.description || '' %>"/>
    </label>

    <label class="stack">
      <span>Base URL</span>
      <input name="base_url" placeholder="http://localhost:3000" value="<%= s.base_url || '' %>"/>
      <small class="muted">If left blank, weâ€™ll fall back to the current request origin.</small>
    </label>

    <label class="checkbox" for="<%= enableToggleId %>">
      <input id="<%= enableToggleId %>" type="checkbox" name="is_enabled" value="true" <%= s.is_enabled ? 'checked' : '' %>/>
      <span>Enable this MCP server immediately</span>
    </label>

    <button class="button primary" type="submit" style="justify-self: flex-start;">Save server</button>
  </form>
</section>

<% if (s.id) { %>
  <section class="surface-card surface-card--stacked">
    <header class="section-heading">
      <div>
        <h3>Manage this server</h3>
        <p class="muted" style="margin: 0;">Toggle availability or jump into related tooling.</p>
      </div>
    </header>
    <div class="action-buttons" style="justify-content: flex-start;">
      <a class="secondary" href="/admin/mcp/<%= s.id %>/info?key=<%= encodeURIComponent(query?.key || '') %>">Connection info</a>
      <a class="secondary" href="/admin/mcp/<%= s.id %>/tools?key=<%= encodeURIComponent(query?.key || '') %>">Manage tools</a>
    </div>
    <div class="action-buttons" style="justify-content: flex-start;">
      <% if (s.is_enabled) { %>
        <form method="post" action="/admin/mcp/<%= s.id %>/disable?key=<%= encodeURIComponent(query?.key || '') %>">
          <button class="button contrast" type="submit">Disable server</button>
        </form>
      <% } else { %>
        <form method="post" action="/admin/mcp/<%= s.id %>/enable?key=<%= encodeURIComponent(query?.key || '') %>">
          <button class="button" type="submit">Enable server</button>
        </form>
      <% } %>
    </div>
  </section>

  <section class="surface-card surface-card--stacked">
    <header class="section-heading">
      <div>
        <h3>Authentication</h3>
        <p class="muted" style="margin: 0;">Configure how this MCP server authenticates to upstream APIs.</p>
      </div>
      <% if (s.id) { %>
        <a class="button" href="/admin/mcp/<%= s.id %>/auth?key=<%= encodeURIComponent(query?.key || '') %>">Edit auth</a>
      <% } %>
    </header>
    <p style="margin: 0;">Auth: <strong><%= authSummary || 'None' %></strong></p>
    <% if (!s.id) { %>
      <p class="muted" style="margin: 0;">Save the server first, then configure authentication.</p>
    <% } %>
  </section>

  <section class="surface-card">
    <header class="section-heading">
      <div>
        <h3>Danger zone</h3>
        <p class="muted" style="margin: 0;">Deleting the server removes all tool mappings.</p>
      </div>
    </header>
    <form method="post" action="/admin/mcp/<%= s.id %>/delete?key=<%= encodeURIComponent(query?.key || '') %>" onsubmit="return confirm('Delete this MCP server?');" class="action-buttons" style="justify-content: flex-start;">
      <button class="button contrast" type="submit">Delete server</button>
    </form>
  </section>
<% } %>
